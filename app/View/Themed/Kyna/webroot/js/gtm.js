"use strict";function GTMUA(){this.init()}GTMUA.prototype={homePage:"Homepage",categoryPage:"Category",subCategoryPage:"Sub Category",searchPage:"Search Result",detailRelevantPage:"Detail - Course Relevant",cartPage:"Cart Page",checkoutPage:"Checkout Page",purchasePage:"Purchase Page",otherPage:"Other Page",init:function(){this.initGTMDataLayer()},initGTMProductClick:function(a){var n=this;switch(a){case n.homePage:(e=$("#k-highlights")).find(">ul>li>a, >ul>li .img>.background-detail>span>a").click(function(){var e=$(this).closest("li"),t={name:e.find(">div.k-box-card-wrap>div.content h4").text(),id:e.find(">a").attr("href"),price:n.deCurrency(e.find(">div.k-box-card-wrap>div.view-price .price > span").text()),brand:e.find(">div.k-box-card-wrap>div.content span.author").text(),cat:"Khóa học nổi bật",position:e.index()+1};n.insertDataProductClick(t,a)});break;case n.categoryPage:case n.subCategoryPage:case n.searchPage:var r=(e=$("#k-listing")).find("span.menu-heading > h1").text();e.find("ul.k-box-card-list>li>a, ul.k-box-card-list>li .img>.background-detail>span>a").click(function(){var e=$(this).closest("li"),t={name:e.find(">div.k-box-card-wrap>div.content h4").text(),id:e.find(">a").attr("href"),price:n.deCurrency(e.find(">div.k-box-card-wrap>div.view-price .price > span").text()),brand:e.find(">div.k-box-card-wrap>div.content span.author").text(),cat:r,position:e.index()+1};n.insertDataProductClick(t,a)});break;case n.detailRelevantPage:var e,r=(e=$(".k-course-details-related")).find(">h3").text();e.find("ul.k-course-details-related-list").find(">li>div.k-related-courses-text>h6>a").click(function(e){e.preventDefault();var t=$(this).closest("li"),i={name:t.find(">div.k-related-courses-text>h6>a").text(),id:t.find(">div.k-related-courses-text>h6>a").attr("href"),price:n.deCurrency(t.find(">div.k-related-courses-text>ul>li:first>span").text()),brand:"",cat:r,position:t.index()+1};n.insertDataProductClick(i,a),window.location.href=$(this).attr("href")})}},initGTMImpression:function(t){var i=this,a=[];switch(t){case i.homePage:(e=$("#k-highlights")).find(">ul").find(">li").each(function(e){a.push({name:$(this).find(">div.k-box-card-wrap>div.content h4").text(),id:i.deUrl($(this).find(">a").attr("href")),price:i.deCurrency($(this).find(">div.k-box-card-wrap>div.view-price .price > span").text()),brand:$(this).find(">div.k-box-card-wrap>div.content span.author").text(),category:"Khóa học nổi bật",variant:"",list:t,position:e+1})});break;case i.categoryPage:case i.subCategoryPage:case i.searchPage:var n=(e=$("#k-listing")).find("header > span > h1").text();e.find("ul.k-box-card-list").find(">li").each(function(e){a.push({name:$(this).find(">div.k-box-card-wrap>div.content h4").text(),id:i.deUrl($(this).find(">a").attr("href")),price:i.deCurrency($(this).find(">div.k-box-card-wrap>div.view-price .price > span").text()),brand:$(this).find(">div.k-box-card-wrap>div.content span.author").text(),category:n,variant:"",list:t,position:e+1})});break;case i.detailRelevantPage:var e,n=(e=$(".k-course-details-related")).find(">h3").text();e.find("ul.k-course-details-related-list").find(">li").each(function(e){a.push({name:$(this).find("div.k-related-courses-text>h6>a").text(),id:i.deUrl($(this).find("div.k-related-courses-text>h6>a").attr("href")),price:i.deCurrency($(this).find("div.k-related-courses-text>ul>li:first>span").text()),brand:"",category:n,variant:"",list:t,position:e+1})})}i.insertDataImpression(a)},initDetailImpression:function(e){var t=this,i=null;switch(e){case t.detailRelevantPage:var a=$(".k-course-details-header"),i={name:a.find(".k-course-details-title>h1").text(),id:window.location.pathname,price:t.deCurrency(a.find(".price-list>ul>li:first").text()),brand:a.find(".k-course-details-title>span").text(),cat:""}}t.insertDataDetailImpression(i)},initFbViewContent:function(e){var t=this,i=null;switch(e){case t.detailRelevantPage:var a=$(".k-course-details-header"),i={name:a.find(".k-course-details-title>h1").text(),id:window.location.pathname,price:t.deCurrency(a.find(".price-list>ul>li:first").text()),brand:a.find(".k-course-details-title>span").text(),cat:""}}t.insertDataFbViewContent(i)},initAddToCart:function(e){var i=this;switch(e){case i.homePage:case i.searchPage:var a=$(".k-popup-lesson"),n="Khóa học nổi bật";$("body").on("click",".add-to-cart",function(e){var t={name:a.find(".modal-header>h4").text(),id:window.location.pathname,price:i.deCurrency(a.find("ul.k-popup-lesson-detail-price>li:first>span.bold").text()),brand:a.find(".modal-body>h6").text(),cat:n,quantity:1};i.insertDataAddToCart(t)});break;case i.detailRelevantPage:a=$(".k-course-details-header").length?$(".k-course-details-header"):$(".k-combo-details-header"),n="";a.find(".add-to-cart").click(function(){var e={name:""!=$(".k-combo-title-md > h1").text()?$(".k-combo-title-md > h1").text():$(".k-course-details-title > h1").text(),id:window.location.pathname,price:i.deCurrency($(".price-list > ul > li:first > span span").text()),brand:a.find(".k-course-details-title > span").text(),cat:n,quantity:1};i.insertDataAddToCart(e)})}},initRemoveFromCart:function(e){var i=this;switch(e){case i.cartPage:var t=$(".k-shopping-list-items");t.find("a.cart-item-remove").click(function(){var e=$(this).closest("li.items"),t={name:e.find(">div.k-shopping-list-items-title>div.items-text>h4>a").text(),id:i.deUrl(e.find(">div.k-shopping-list-items-title>div.items-text>h4>a").attr("href")),price:i.deCurrency(e.find(">div.k-shopping-list-items-price>span.sale").text()),brand:e.find(">div.k-shopping-list-items-title>div.items-text>p").text(),cat:""};i.insertDataRemoveFromCart(t)})}},initCheckout:function(e){var i=this;switch(e){case i.checkoutPage:var a=$("#checkout-home");a.find('div.wrap-checkout-button-pc > .checkout-button[type="submit"]').click(function(){var t=[];a.find("ul.list>li").each(function(e){t.push({name:$(this).find(">div.text>h6>a").text(),id:i.deUrl($(this).find(">div.text>h6>a").attr("href")),price:i.deCurrency($(this).find(">div.text>span.price").text()),brand:"",category:"",position:e+1,quantity:1})}),i.insertDataOnCheckout(t)})}},initPurchase:function(e){var t=this;switch(e){case t.purchasePage:var i,a,n,r=$("#checkout-succ-online");0<r.find(".checkout-succ-title").length&&(i=[],a=r.find(".checkout-list-price"),n={id:r.find(".checkout-succ-title .media-body>span>strong").text(),affiliation:"Kyna.vn",revenue:t.deCurrency(a.find(">ul>li:last>span.price").text()),tax:"0",shipping:0<a.find(">ul>li:last>span.shipping-price").length?t.deCurrency(a.find(">ul>li:last>span.shipping-price").text()):"0",coupon:6==r.find(".checkout-banner-confirm>ul>li:last>p").length?r.find(".checkout-banner-confirm>ul>li:last>p:last").text():""},r.find("ul.list>li").each(function(e){i.push({name:$(this).find(">div.text>h6>a").text(),id:t.deUrl($(this).find(">div.text>h6>a").attr("href")),price:t.deCurrency($(this).find(">div.text>span.price").text()),brand:"",category:"",coupon:"",quantity:1})}),t.insertDataPurchase(n,i))}},initGTMReMarketing:function(e){var t=this,i=[];switch(e){case t.homePage:dataLayer.push({event:"google_tag_params",remarketing_data:{dynx_pagetype:"home"}});break;case t.categoryPage:case t.subCategoryPage:case t.searchPage:(a=$("#k-listing")).find("ul.k-box-card-list").find(">li").each(function(e){i.push(t.deUrl($(this).find(">a").attr("href")))}),dataLayer.push({event:"google_tag_params",remarketing_data:{dynx_itemid:i,dynx_pagetype:"searchresults"}});break;case t.detailRelevantPage:var a=$(".k-course-details-header");dataLayer.push({event:"google_tag_params",remarketing_data:{dynx_itemid:window.location.pathname,dynx_pagetype:"offerdetail",dynx_totalvalue:t.deCurrency(a.find(".price-list>ul>li:first").text())}});break;case t.otherPage:dataLayer.push({event:"google_tag_params",remarketing_data:{dynx_pagetype:"other"}})}t.insertDataImpression(i)},initFbq:function(e){var t=this;switch(e){case t.searchPage:var i=$("#k-listing span.menu-heading > h1").text();dataLayer.push({event:"fbqSearch",search_string:i});break;case t.detailRelevantPage:break;case t.purchasePage:var a,n,r=$("#checkout-succ-online");0<r.find(".checkout-succ-title").length&&(a=r.find(".checkout-list-price"),n={id:r.find(".checkout-succ-title .media-body>span>strong").text(),affiliation:"Kyna.vn",revenue:t.deCurrency(a.find(">ul>li:last>span.price").text()),tax:"0",shipping:0<a.find(">ul>li:last>span.shipping-price").length?t.deCurrency(a.find(">ul>li:last>span.shipping-price").text()):"0",coupon:6==r.find(".checkout-banner-confirm>ul>li:last>p").length?r.find(".checkout-banner-confirm>ul>li:last>p:last").text():""},dataLayer.push({event:"fbqPurchase",value:n.revenue}))}},insertDataImpression:function(e){0<e.length&&dataLayer.push({ecommerce:{impressions:e}})},insertDataProductClick:function(e,t){dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:t},products:[{name:e.name,id:e.id,price:e.price,brand:e.brand,category:e.cat,position:e.position}]}}})},insertDataDetailImpression:function(e){dataLayer.push({ecommerce:{detail:{actionField:{list:"Detail"},products:[{name:e.name,id:e.id,price:e.price,brand:e.brand,category:e.cat}]}}})},insertDataFbViewContent:function(e){dataLayer.push({event:"fbqViewContent",product_id:e.id,product_name:e.name,product_category:e.cat,product_price:e.price})},insertDataAddToCart:function(e){dataLayer.push({event:"fbqAddToCart",product_id:e.id,product_name:e.name,product_price:e.price}),dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"VND",add:{products:[{name:e.name,id:e.id,price:e.price,brand:e.brand,category:e.cat,quantity:e.quantity}]}}})},insertDataRemoveFromCart:function(e){dataLayer.push({event:"removeFromCart",ecommerce:{remove:{products:[{name:e.name,id:e.id,price:e.price,brand:e.brand,category:e.cat}]}}})},insertDataOnCheckout:function(e){dataLayer.push({event:"checkout",ecommerce:{checkout:{actionField:{step:1},products:e}}})},insertDataPurchase:function(e,t){dataLayer.push({ecommerce:{purchase:{actionField:e,products:t}}})},initGTMDataLayer:function(){var e=this,t=window.location.pathname,i=window.location.search,a=new RegExp(/[a-z0-9-]+/g),n=t.match(a);null===n?(e.initGTMImpression(e.homePage),e.initGTMProductClick(e.homePage),e.initAddToCart(e.homePage),e.initGTMReMarketing(e.homePage)):0<n.length&&"gio-hang"===n[0]?(e.initRemoveFromCart(e.cartPage),e.initGTMReMarketing(e.otherPage)):0<n.length&&"thanh-toan"===n[0]&&"thanh-cong"===n[1]?(e.initPurchase(e.purchasePage),e.initGTMReMarketing(e.otherPage),e.initFbq(e.purchasePage)):0<n.length&&"thanh-toan"===n[0]?(e.initCheckout(e.checkoutPage),e.initGTMReMarketing(e.otherPage)):0<n.length&&""===i&&0<$(".k-course-details-related").length?(e.initGTMImpression(e.detailRelevantPage),e.initGTMProductClick(e.detailRelevantPage),e.initDetailImpression(e.detailRelevantPage),e.initAddToCart(e.detailRelevantPage),e.initGTMReMarketing(e.detailRelevantPage),e.initFbViewContent(e.detailRelevantPage)):n.length<3&&""===i&&0<$("#k-listing").length?(e.initGTMImpression(e.categoryPage),e.initGTMProductClick(e.categoryPage),e.initGTMReMarketing(e.categoryPage)):3<=n.length&&""===i&&0<$("#k-listing").length?(e.initGTMImpression(e.subCategoryPage),e.initGTMProductClick(e.subCategoryPage),e.initGTMReMarketing(e.subCategoryPage)):0<n.length&&""!==i&&0<$("#k-listing").length?(e.initGTMImpression(e.searchPage),e.initGTMProductClick(e.searchPage),e.initGTMReMarketing(e.searchPage),e.initFbq(e.searchPage),e.initAddToCart(e.searchPage)):e.initGTMReMarketing(e.otherPage)},deCurrency:function(e){var t=e.match(/[\d\,\.]+/g);return t?t[0].replace(/,/g,".").replace(/\s/g,"").replace(/\./g,""):e},deUrl:function(e){return e.replace(/\-p[0-9]{1,}.*/g,"")}};
